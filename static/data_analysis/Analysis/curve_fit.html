
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Curve Fitting &mdash; Introduction to Data Analysis for Physics</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.0.0-rc1/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/video.css" type="text/css" />
    <link rel="stylesheet" href="../_static/poll.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tabbedstuff.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/pytutor.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/codemirror.css" type="text/css" />
    <link rel="stylesheet" href="../_static/activecode.css" type="text/css" />
    <link rel="stylesheet" href="../_static/parsons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/lib/prettify.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.0.0-rc1/css/bootstrap-glyphicons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/jquery-ui-1.10.3.custom.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/user-highlights.css" type="text/css" />
    <link rel="stylesheet" href="../../runestone-custom-sphinx-bootstrap.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/poll.js"></script>
    <script type="text/javascript" src="../_static/js/d3.v2.min.js"></script>
    <script type="text/javascript" src="../_static/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery.ba-bbq.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery.jsPlumb-1.3.10-all-min.js"></script>
    <script type="text/javascript" src="../_static/js/pytutor.js"></script>
    <script type="text/javascript" src="../_static/jquery.highlight.js"></script>
    <script type="text/javascript" src="../_static/bookfuncs.js"></script>
    <script type="text/javascript" src="../_static/codemirror.js"></script>
    <script type="text/javascript" src="../_static/python.js"></script>
    <script type="text/javascript" src="../_static/activecode.js"></script>
    <script type="text/javascript" src="../_static/skulpt.js"></script>
    <script type="text/javascript" src="../_static/builtin.js"></script>
    <script type="text/javascript" src="../_static/assess.js"></script>
    <script type="text/javascript" src="../_static/animationbase.js"></script>
    <script type="text/javascript" src="../_static/lib/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/lib/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../_static/lib/prettify.js"></script>
    <script type="text/javascript" src="../_static/lib/underscore-min.js"></script>
    <script type="text/javascript" src="../_static/lib/lis.js"></script>
    <script type="text/javascript" src="../_static/parsons.js"></script>
    <script type="text/javascript" src="../_static/parsons-noconflict.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/jquery-ui-1.10.3.custom.min.js"></script>
    <script type="text/javascript" src="../_static/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.0.0-rc1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <script type="text/javascript" src="../_static/waypoints.min.js"></script>
    <script type="text/javascript" src="../_static/rangy-core.js"></script>
    <script type="text/javascript" src="../_static/rangy-textrange.js"></script>
    <script type="text/javascript" src="../_static/rangy-cssclassapplier.js"></script>
    <script type="text/javascript" src="../_static/user-highlights.js"></script>
    <script type="text/javascript" src="../_static/jquery.idle-timer.js"></script>
    <script type="text/javascript" src="../_static/processing-1.4.1.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.hotkey.js"></script>
    <link rel="top" title="Introduction to Data Analysis for Physics" href="../index.html" />
    <link rel="next" title="Approximations" href="approximations.html" />
    <link rel="prev" title="The Gaussian Distribution" href="gaussian.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
<script type="text/javascript">
  eBookConfig = {};
  eBookConfig.host = 'http://127.0.0.1:8000' ? 'http://127.0.0.1:8000' : 'http://127.0.0.1:8000';
  eBookConfig.app = eBookConfig.host+'/runestone';
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.course = 'data_analysis';
  eBookConfig.logLevel = 10;
  eBookConfig.loginRequired = false
  eBookConfig.isLoggedIn = false;
</script>

<div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&status=0";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>


  </head>
  <body>


<!-- Begin navbar -->
<div id="navbar" class="navbar navbar-fixed-top" style="z-index:9999999">

  <div class="container">

    <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
    <button type='button' class='navbar-toggle' data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>

    <div>
      <a href="../index.html">
      <img title="Data Analysis for Physics" src="../_static/img/logo_small.png"
       style="max-width:60px; max-height:60px;float:left"></a>
      <a class="navbar-brand" href="../index.html">Introduction to Data Analysis for Physics</a>
    </div>

    <div class="nav-collapse collapse navbar-responsive-collapse">

      <ul class="nav navbar-nav">
        <li class="divider-vertical"></li>
        
          <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Curve Fitting</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#residuals">Residuals</a></li>
<li><a class="reference internal" href="#least-squares-fitting">Least-Squares Fitting</a></li>
<li><a class="reference internal" href="#the-findfit-function">The FindFit Function</a></li>
<li><a class="reference internal" href="#interpolation">Interpolation</a></li>
<li><a class="reference internal" href="#mathematica-fitting-functions"><em>Mathematica</em> Fitting Functions</a></li>
</ul>
</li>
</ul>
</ul>
</li>
          <li class="divider-vertical"></li>
        
        
          
  <li id="relations-prev" title="Previous Chapter - The Gaussian Distribution" data-toggle="tooltip">
    <a href="gaussian.html" >
      <i class='glyphicon glyphicon-backward' style='opacity:0.9;'></i>
      <p style=";max-width:130px;">The Gaussian Distribution</p>
    </a>
  </li>
  
  <li id="relations-next" title='Next Chapter - Approximations' data-toggle="tooltip" >
    <a href="approximations.html" >
      <i class='glyphicon glyphicon-forward' style='opacity:0.9;'></i>
      <p style=";max-width:130px;">Approximations</p>
    </a>
  </li>
  <li style="divider-vertical"></li>

<script type="text/javascript">
  opts = {'placement':'bottom',
          'selector': '',
          'delay': { show: 100, hide: 50}
         };

  $('#relations-prev').tooltip(opts);
  $('#relations-next').tooltip(opts);
</script>
        
        
          <li></li>
        
      </ul>

    </div>
  </div>
</div>


<div id="mainbody" class="container">
  
  <div class="section" id="curve-fitting">
<h1>Curve Fitting<a class="headerlink" href="#curve-fitting" title="Permalink to this headline">¶</a></h1>
<p>To best learn about the curve fitting process, we&#8217;ll go through a contrived example to
show some of the relevant <em>Mathematica</em> features, then describe how the functions
work and how to apply them in a lab scenario, introducing other useful mathematical
constructs along the way to help you analyze your data.</p>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>One part of analyzing data that is frequently useful is where we have some set of
data and a model to which we believe it corresponds. Then, we can have <em>Mathematica</em>
find a fit for the data based on the model. For an example of how this works,
let&#8217;s sample points from <span class="math">\((x-2)^2-1=x^2-4x+3\)</span>, then have <em>Mathematica</em> fit
this (incorrectly) to <span class="math">\(ax^2+bx\)</span>:</p>
<div class="highlight-python"><pre>t = Table[{x, (x - 2)^2 - 1}, {x, -10, 10}];
fn[x_] := a x^2 + b x
fit = FindFit[t, fn[x], {a, b}, {x}];
fn[x] /. fit
Show[ListPlot[t], Plot[fn[x] /. fit, {x, -10, 10}], PlotRange -&gt; All]</pre>
</div>
<p>prints</p>
<div class="highlight-python"><pre>-4. x + 1.04559 x^2</pre>
</div>
<p>and plots</p>
<div class="figure align-center">
<img alt="Fitted curve" src="../_images/fit_curve.png" />
<p class="caption">Plot of data from <span class="math">\(f(x)=(x-2)^2-1\)</span> plotted against fitted curve for
<span class="math">\(g(x)=ax^2+bx\)</span>.</p>
</div>
</div>
<div class="section" id="residuals">
<h2>Residuals<a class="headerlink" href="#residuals" title="Permalink to this headline">¶</a></h2>
<p>It is not immediately clear that this fit is bad (although if we calculated the <span class="math">\(R^2\)</span>
statistical value, we would have a better indication than just the graph). So, one important
thing to always do is to view the residuals of the fit. If we have a point in the dataset
<span class="math">\((x_i, f_i)\)</span>, and fitted function <span class="math">\(\hat{f}\)</span>, the fitted value at <span class="math">\(x_i\)</span>
is simply <span class="math">\(\hat{f}(x_i)\)</span>. Then, the residual is the difference between data and
fitted values <span class="math">\(f_i-\hat{f}(x_i)\)</span>. If we plot this versus our independent variable</p>
<div class="highlight-python"><pre>r = Table[{t[[i, 1]], t[[i, 2]] - fn[t[[i, 1]]] /. fit},
{i, 1, Length[t]}];
ListPlot[r]</pre>
</div>
<p>we can see if any kind of pattern arises (again, a visual inspection, but a useful one
nevertheless - we&#8217;ll add statistics momentarily):</p>
<div class="figure align-center">
<img alt="Bad residual plot" src="../_images/bad_resid.png" />
<p class="caption">Residual plot for data and fitted curve.</p>
</div>
<p>Here, we see that there is indeed a clear pattern to the residual plot (a parabola). Recall
that we didn&#8217;t fit the correct function, so we might expect the residuals to follow some
sort of predictable distribution that accounts for the difference between actual function
and the one fitted.</p>
</div>
<div class="section" id="least-squares-fitting">
<h2>Least-Squares Fitting<a class="headerlink" href="#least-squares-fitting" title="Permalink to this headline">¶</a></h2>
<p><em>Mathematica</em> performs what is known as a least-squares fit of the data when applying
the <tt class="code docutils literal"><span class="pre">FindFit</span></tt> function. In short, using the notation above, a least-squares fit
is one that creates a function such that the following quantity is minimized:</p>
<div class="math">
\[\sum_{i=1}^Nr_i^2=\sum_{i=1}^N\left(f_i-\hat{f}(x_i)\right)^2\]</div>
<p>But minimizing a quantity means finding a critical point, which we can do by noting that
the derivative of the quantity above is 0 with respect to all coefficients that are being
fitted. So, if the function to be fitted is a function of <span class="math">\(M\)</span> coeffiencents
<span class="math">\(\{c_j\}\)</span>, we have that:</p>
<div class="math">
\[\begin{split}\forall{j\in[1,M]}:&amp;\\
0&amp;=\sum_{i=1}^N2r_i\frac{dr_i}{dc_j}\\
&amp;=\sum_{i=1}^N2r_i\frac{d\left(f_i-\hat{f}(x_i)\right)}{dc_j}\\
&amp;=-2\sum_{i=1}^N\left(f_i-\hat{f}(x_i)\right)\frac{d\hat{f}(x_i)}{dc_j}\end{split}\]</div>
<p>We know the function we are trying to fit, and have the data. Thus, we have
everything we need to be able to solve this, presuming that we can then solve
the resulting equations for all the coefficients.</p>
<div class="note admonition">
<p class="first admonition-title">Least-Squares Worked Example</p>
<p>For an example, let&#8217;s take the data <a class="reference download internal" href="../_downloads/least_squares.csv"><tt class="xref download docutils literal"><span class="pre">here</span></tt></a>.
Go ahead and import it using the techniques described in the
<a class="reference external" href="../Mathematica/import.html">Import</a> section, then plot the data.
You should see 6 points that look linear. Let&#8217;s assume the function
is <span class="math">\(ax+b\)</span>. Let&#8217;s see what our equation above tells us.
<span class="math">\(\frac{d\hat{f}(x)}{da}=x,~\frac{d\hat{f}(x)}{db}=1\)</span>. So,</p>
<div class="math">
\[\begin{split}0&amp;=\left(3.11431-(0a+b)\right)*0+\left(8.14437-(a+b)\right)*1 +
                \left(13.2145-(2a+b)\right)*2\\
&amp;+\left(18.2655-(3a+b)\right)*3+\left(23.2041-(4a+b)\right)*4 +
                \left(28.3593-(5a+b)\right)*5\\
{\textrm{and}}&amp;\\
0&amp;=\left(3.11431-(0a+b)\right)+\left(8.14437-(a+b)\right) +
                \left(13.2145-(2a+b)\right)\\
&amp;+\left(18.2655-(3a+b)\right)+\left(23.2041-(4a+b)\right) +
                \left(28.3593-(5a+b)\right)\end{split}\]</div>
<p>If we combine terms in each equation, we arrive at:</p>
<div class="math">
\[\begin{split}0&amp;=-55(-5.8906+a+0.272727b)\\
0&amp;=94.3021-15a-6b\end{split}\]</div>
<p>This is the equation described by:</p>
<div class="math">
\[\begin{split}\left(\begin{array}{cc}
1 &amp; 0.272727 \\ 15 &amp; 6 \end{array}\right)
\left(\begin{array}{c}
a \\ b
\end{array}\right)=
\left(\begin{array}{c}
5.8906 \\ 94.3021
\end{array}\right)\end{split}\]</div>
<p>We can then compute the inverse of the coefficient matrix in whatever way we find
convenient to arrive at:</p>
<div class="math">
\[\begin{split}\left(\begin{array}{c}
a \\ b
\end{array}\right)=
\left(\begin{array}{cc}
1 &amp; 0.272727 \\ 15 &amp; 6 \end{array}\right)^{-1}
\left(\begin{array}{c}
5.8906 \\ 94.3021
\end{array}\right)=
\left(\begin{array}{c}
5.04159 \\ 3.11305
\end{array}\right)\end{split}\]</div>
<p>Which, within rounding, is exactly what we get by running</p>
<div class="highlight-python"><pre>table = Import["least_squares.csv"];
fn[x_] := a x + b
fit = FindFit[table, fn[x], {a,b}, x]</pre>
</div>
<p>However, if we take a residual plot, we see that the value of the residual
generally increases with <span class="math">\(x\)</span>. Might we have missed something? What about
trying instead <tt class="code docutils literal"><span class="pre">fn[x_]:=a</span> <span class="pre">x</span> <span class="pre">^2</span> <span class="pre">+</span> <span class="pre">b</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">c</span></tt>? Running the fitting function on that:</p>
<div class="highlight-python"><pre>fn[x_]:=a x ^2 + b x + c;
fit = FindFit[table, fn[x], {a, b, c}, x]</pre>
</div>
<p>gives us the fit <tt class="code docutils literal"><span class="pre">{a</span> <span class="pre">-&gt;</span> <span class="pre">0.00178178,</span> <span class="pre">b</span> <span class="pre">-&gt;</span> <span class="pre">5.03267,</span> <span class="pre">c</span> <span class="pre">-&gt;</span> <span class="pre">3.11901}</span></tt>. And in fact,
this is closer in form to how the data was created:</p>
<div class="highlight-python"><pre>Table[{x, 0.01 x^2 + 5 x + 3 + RandomReal[]/3}, {x, 0, 5}]</pre>
</div>
<p>Using the first fitting function (just <span class="math">\(ax+b\)</span>), the sum
<span class="math">\(\sum_{i=1}^Nr_i^2\)</span> is 0.008344. Using the second, this is 0.008226.
The improvement is certainly slight. We might be tempted to go to a higher
order polynomial:</p>
<div class="highlight-python"><pre>fn[x_]:=a x ^ 5 + b x ^4 + c x ^ 3 + d x ^ 2 + e x + f;
fit = FindFit[table, fn[x], {a, b, c, d, e, f}, x]</pre>
</div>
<p class="last">gives astonishingly good results for
<tt class="code docutils literal"><span class="pre">{a</span> <span class="pre">-&gt;</span> <span class="pre">-0.155636,</span> <span class="pre">b</span> <span class="pre">-&gt;</span> <span class="pre">5.08982,</span> <span class="pre">c</span> <span class="pre">-&gt;</span> <span class="pre">3.11431,</span> <span class="pre">d</span> <span class="pre">-&gt;</span> <span class="pre">0.131463,</span> <span class="pre">e</span> <span class="pre">-&gt;</span> <span class="pre">-0.0393806,</span> <span class="pre">f</span> <span class="pre">-&gt;</span> <span class="pre">0.0037974}</span></tt>
with the sum of squared residuals being <span class="math">\(3.24\times10^{-28}\)</span>! But how can this be?
We added random errors to the data, so how could the sum of the squared residuals
be so small? Well, since we only have <span class="math">\(N=6\)</span> points, we can fit a polynomial
of degree <span class="math">\((N-1)=5\)</span> exactly. That&#8217;s great, but doesn&#8217;t actually let us know
about the real underlying function (the original parameters are now radically different
than before). The shape of the function is totally different outside the range of
the data. This makes <em>extrapolation</em>, using the function to predict values outside
the range, very difficult and inaccurate. However, the over-fitting function may
be able to predict values within the range very well - it exactly predicts the values
provided in the data. Thus, it may be good at <em>interpolation</em>. In principle, we benefit
most from knowing (or approximating) the actual function at work, rather than
just focusing on finding any function that best fits our data.</p>
</div>
</div>
<div class="section" id="the-findfit-function">
<h2>The FindFit Function<a class="headerlink" href="#the-findfit-function" title="Permalink to this headline">¶</a></h2>
<p>We&#8217;ve used it multiple times already, but the <tt class="code docutils literal"><span class="pre">FindFit</span></tt> function is extremely useful
and works with pretty much any form of function. For example, we could try to fit an
exponential function <span class="math">\(f(t)=Pe^{rt}\)</span> or sinusoidal <span class="math">\(g(t)=A\cos(\omega{t}-\phi)\)</span>.
But, we can do even better. In the examples above, we showed a function of a single
variable, and treated it as a set of points <span class="math">\(\left(x_i,~f(x_i)\right)\)</span>. But,
we can have more complicated functions by providing points such as
<span class="math">\(\left(x_i,~y_i,~f(x_i,~y_i)\right)\)</span>. Let&#8217;s label things a little more consistently.
Let&#8217;s say we have a function <span class="math">\(f(\overline{v})\)</span> where
<span class="math">\(\overline{v}=\{v_1, v_2, ..., v_n\}\)</span> is a vector representing the values of the
<span class="math">\(n\)</span> variables for the function. And furthermore, let&#8217;s say that the function is
based on <span class="math">\(m\)</span> parameters <span class="math">\(\{c_1, c_2, ..., c_m\}\)</span>. We have the data
for specific values of <span class="math">\(\overline{v_i}\)</span> as entries read as
<span class="math">\(data_i=\{v_{1,i}, v_{2,i}, ..., v_{n,i}, f\left(v_{1,i}, v_{2,i}, ..., v_{n,i}\right)\}\)</span>.
Then, the function is</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">FindFit</span><span class="p">[</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">v_1</span><span class="p">,</span> <span class="n">v_2</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">v_n</span><span class="p">],</span> <span class="p">{</span><span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">c_m</span><span class="p">},</span> <span class="p">{</span><span class="n">v_1</span><span class="p">,</span> <span class="n">v_2</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">v_n</span><span class="p">}]</span>
</pre></div>
</div>
<p>where in this form, each <tt class="code docutils literal"><span class="pre">v_i</span></tt> and <tt class="code docutils literal"><span class="pre">c_i</span></tt> are listed as symbols, not
numbers. The function will produce a mapping for each <tt class="code docutils literal"><span class="pre">c_i</span></tt> that best fits <tt class="code docutils literal"><span class="pre">data</span></tt>.</p>
<p>Sometimes, if one method does not converge on the function, we can try a different one.
For example, providing <tt class="code docutils literal"><span class="pre">Method-&gt;NMinimize</span></tt> as an option. Others can be viewed in the
documentation for <tt class="code docutils literal"><span class="pre">FindFit</span></tt>.</p>
<div class="admonition-practice-problem-multivariate-curve-fitting admonition">
<p class="first admonition-title">Practice Problem: Multivariate Curve Fitting</p>
<p>Considering the following dataset: <a class="reference download internal" href="../_downloads/prac_multi.csv"><tt class="xref download docutils literal"><span class="pre">prac_multi.csv</span></tt></a>.
Let the columns represent <span class="math">\((t, x, f(t,x))\)</span> for some function <span class="math">\(f\)</span>.
Create a 3D point plot of the data - what do you see? When viewed flat on a
side with the <tt class="code docutils literal"><span class="pre">x</span></tt> values across the horizontal axis, can you see
a familiar function for <span class="math">\(t=0\)</span>? When viewed with <tt class="code docutils literal"><span class="pre">t</span></tt> on the
horizontal axis, do we see another function? Some kind of exponential decay?</p>
<p>Hopefully, from visual inspection, we can see that the function
<span class="math">\(f(t,x)=T(t)X(x)\)</span>, in other words, that the function is separable.
Guess at a function <tt class="code docutils literal"><span class="pre">f[t_,x_]</span></tt> with two coefficients <tt class="code docutils literal"><span class="pre">k,r</span></tt> (one
for each separated function). Try to find the fitting function for
<tt class="code docutils literal"><span class="pre">k,</span> <span class="pre">r</span></tt>. Did <tt class="code docutils literal"><span class="pre">FindFit</span></tt> converge? How about if we
try the only other method referenced, <tt class="code docutils literal"><span class="pre">Method-&gt;NMinimize</span></tt>? How does this
compare with the original data? Does it match perfectly?</p>
<p class="last">Hint: For the functions to fit, they are very simple, in that if we made
the substitutions <span class="math">\(kx\rightarrow{y},~rt\rightarrow{\tau}\)</span>,
the separated functions would be an elementary function that is
parameterized by the single associated variable (<span class="math">\(y\)</span> or <span class="math">\(\tau\)</span>),
with no other numbers to guess, such as <span class="math">\(\tan(y)\tau^{-1}\)</span>.</p>
</div>
</div>
<div class="section" id="interpolation">
<h2>Interpolation<a class="headerlink" href="#interpolation" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="code docutils literal"><span class="pre">FindFit</span></tt> function is great when we have a model, and in practice, this is
often the case. However, one other method we can use is interpolation. This is a process
where we find a function (perhaps a piecewise one) that fits our data, to approximate
values within the range of our data. For example, we could draw a straight line
between points. This sounds like it could be hazardous in representing
the data, but this does depend on how close together the data is
and how precise we need to be, as seen in the following:</p>
<div class="figure align-center">
<img alt="GIF of sine" src="../_images/joined_sample.gif" />
<p class="caption"><span class="math">\(\sin(x)\)</span> as sampled with different intervals between points.</p>
</div>
<p>Mathematically speaking, when we take this straight line fit on <span class="math">\(N\)</span>
points, we create <span class="math">\(N-1\)</span> line segments that start at one point, then
go to the next. We could, of course, create <tt class="code docutils literal"><span class="pre">N-2</span></tt> sections, creating a quadratic
fit based on the current point and next two points, then plotting that
from the current point to the next. We can do this all the way up to a single section
that is a fit of order <span class="math">\(N-1\)</span>, which will be everywhere smooth and differentiable.
As an example, see the following:</p>
<div class="figure align-center">
<img alt="GIF of InterpolationOrder" src="../_images/interp_sample.gif" />
<p class="caption">Data fitted at different values for <tt class="code docutils literal"><span class="pre">InterpolationOrder</span></tt></p>
</div>
<p>We&#8217;ll look at how to do these fits in <em>Mathematica</em> shortly, but first, we can look at
the math behind the fitting functions. If we take the &#8220;interpolation order&#8221; to be
the order of the fit between points and represent it by <span class="math">\(m\)</span>, we create a polynomial
using points <span class="math">\(x_i,~x_{i+1},~...,~x_{i+m}\)</span> (in the single-variable case - these
functions and processes generalize) of order <span class="math">\(m\)</span>:</p>
<div class="math">
\[f_i(x)=a_{i,0}x^0+a_{i,1}x^1+a_{i,2}x^2+\cdots+a_{i,m}x^m\]</div>
<p>If we have the data for each point <span class="math">\(\left(x_i,~y_i\right)\)</span>,
with <span class="math">\(m\)</span> points, we can
solve for the coefficients using</p>
<div class="math">
\[\sum_{j=0}^ma_{i,j}x_{i+k}^j=y_{i+k},~k\in[0,m]\]</div>
<p>or, more usefully,</p>
<div class="math">
\[\begin{split}\left(\begin{array}{ccccc}
x_i^0 &amp; x_i^1 &amp; x_i^2 &amp;  &amp; x_i^m \\
x_{i+1}^0 &amp; x_{i+1}^1 &amp; x_{i+1}^2 &amp; \cdots &amp; x_{i+1}^m \\
x_{i+2}^0 &amp; x_{i+2}^1 &amp; x_{i+2}^2 &amp; &amp; x_{i+2}^m\\
  &amp; \vdots &amp; &amp; \ddots &amp; \vdots \\
x_{i+m}^0 &amp; x_{i+m}^1 &amp; x_{i+m}^2 &amp; \cdots &amp; x_{i+m}^m
\end{array}\right)
\left(\begin{array}{c}
a_{i,0} \\ a_{i,1} \\ a_{i,2} \\ \vdots \\ a_{i,m}
\end{array}\right)=
\left(\begin{array}{c}
y_i \\ y_{i+1} \\ y_{i+2} \\ \vdots \\ y_{i+m}
\end{array}\right)\end{split}\]</div>
<p>With this formulation, we can invert the square matrix and compute the coefficients:</p>
<div class="math">
\[\begin{split}\left(\begin{array}{c}
a_{i,0} \\ a_{i,1} \\ a_{i,2} \\ \vdots \\ a_{i,m}
\end{array}\right)=
\left(\begin{array}{ccccc}
x_i^0 &amp; x_i^1 &amp; x_i^2 &amp;  &amp; x_i^m \\
x_{i+1}^0 &amp; x_{i+1}^1 &amp; x_{i+1}^2 &amp; \cdots &amp; x_{i+1}^m \\
x_{i+2}^0 &amp; x_{i+2}^1 &amp; x_{i+2}^2 &amp; &amp; x_{i+2}^m\\
  &amp; \vdots &amp; &amp; \ddots &amp; \vdots \\
x_{i+m}^0 &amp; x_{i+m}^1 &amp; x_{i+m}^2 &amp; \cdots &amp; x_{i+m}^m
\end{array}\right)^{-1}
\left(\begin{array}{c}
y_i \\ y_{i+1} \\ y_{i+2} \\ \vdots \\ y_{i+m}
\end{array}\right)\end{split}\]</div>
<p>In the linear case (<span class="math">\(f_i(x)=a_{i,0}+a_{i,1}x\)</span>), this gives:</p>
<div class="math">
\[\begin{split}\left(\begin{array}{c}
a_{i,0} \\ a_{i,1}
\end{array}\right)=
\left(\begin{array}{c}
\frac{x_{i+1}y_i-x_iy_{i+1}}{x_{i+1}-x_i}\\
\frac{y_{i+1}-y_i}{x_{i+1}-x_i}
\end{array}\right)\end{split}\]</div>
<p>We can plot the function <span class="math">\(f_i(x)\)</span> over the domain <span class="math">\(x\in[x_i,x_{i+1}]\)</span>,
then repeat this process for each other segment, giving a function</p>
<div class="math">
\[\begin{split}f(x)=\left\{\begin{array}{ccc}
f_1(x) &amp; &amp; x_1\leq{x}&lt;x_2\\
f_2(x) &amp; &amp; x_2\leq{x}&lt;x_3\\
&amp; \vdots &amp; \\
f_i(x) &amp; &amp; x_i\leq{x}&lt;x_{i+1}\\
&amp; \vdots &amp; \\
f_{n-m}(x) &amp; &amp; x_{n-m}\leq{x}\leq{x_n}
\end{array}\right.\end{split}\]</div>
<p>In <em>Mathematica</em>, there are several related functions for interpolation, the one
that is most related to the discussion above being, conveniently, <tt class="code docutils literal"><span class="pre">Interpolation</span></tt>.
<tt class="code docutils literal"><span class="pre">Interpolation</span></tt> takes the data, either as
<tt class="code docutils literal"><span class="pre">{{x1,</span> <span class="pre">f1},</span> <span class="pre">{x2,</span> <span class="pre">f2},</span> <span class="pre">...,</span> <span class="pre">{xn,</span> <span class="pre">fn}}</span></tt>, or
<tt class="code docutils literal"><span class="pre">{{{x1,</span> <span class="pre">y1,</span> <span class="pre">...},</span> <span class="pre">f1},</span> <span class="pre">{{x2,</span> <span class="pre">y2,</span> <span class="pre">...},</span> <span class="pre">f2},</span> <span class="pre">...,</span> <span class="pre">{{xn,</span> <span class="pre">yn,</span> <span class="pre">...},</span> <span class="pre">fn}}</span></tt>
and produces a regular function in the number of variables given (the default
interpolation order is 3, but easily changed as seen below). For example,</p>
<div class="highlight-python"><pre>t = Table[{x, Sin[2x]}, {x, 0, 2 Pi, .5}];

(*Creates single-variable function, given order i*)
fn = Interpolation[t, InterpolationOrder -&gt; i]

(*Code for each frame below*)
Show[
        ListPlot[t, PlotStyle -&gt; PointSize[Medium]],
        Plot[
                {fn[x], Sin[2x]},
                {x, 0, 2 Pi},
                PlotLegends -&gt; {"Fitted Curve", "Sin[2x]"}],
        PlotRange -&gt; {{0, 2 Pi}, {-1, 1}},
        PlotLabel -&gt; "InterpolationOrder-&gt;" &lt;&gt; ToString[i]]</pre>
</div>
<div class="figure align-center">
<img alt="Piecewise Interpolation Example" src="../_images/pointwise.gif" />
<p class="caption">Plots for fitting data to <span class="math">\(f(x)=\sin(2x)\)</span>.</p>
</div>
<p>We can also use <tt class="code docutils literal"><span class="pre">InterpolatingPolynomial[data,</span> <span class="pre">{var1,</span> <span class="pre">...}]</span></tt> to do this, which
will create a single polynomial (degree <span class="math">\(N-1\)</span> where <span class="math">\(N\)</span> is the number of
points in our dataset in the single variable case) defined in terms of the variables
given. In other words,</p>
<div class="highlight-python"><pre>f1[x_] := Module[{y}, InterpolatingPolynomial[t, y] /. {y -&gt; x}]
f2[x_] := Interpolation[t, InterpolationOrder -&gt; Length[t] - 1][x]</pre>
</div>
<p>represent the same underlying function. The former does all the math in an arbitrary
local variable <tt class="code docutils literal"><span class="pre">y</span></tt>, then substitutes for <tt class="code docutils literal"><span class="pre">y</span></tt>, the value of <tt class="code docutils literal"><span class="pre">x</span></tt>, which could
be symbolic. The latter creates the function of an arbitrary variable of its own, to which
we then apply the argument given to us then return the result.</p>
</div>
<div class="section" id="mathematica-fitting-functions">
<h2><em>Mathematica</em> Fitting Functions<a class="headerlink" href="#mathematica-fitting-functions" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="code docutils literal"><span class="pre">NonlinearModelFit</span></tt> and <tt class="code docutils literal"><span class="pre">LinearModelFit</span></tt> functions are perhaps even
more useful than the <tt class="code docutils literal"><span class="pre">FindFit</span></tt> function. Instead of just providing coefficients
for the fit, these produce information about the fit itself. For example:</p>
<div class="highlight-python"><pre>data = Table[{i, 2 i^3 + Random[]*.02}, {i, 10}];
fit = NonlinearModelFit[data, a x^b, {a, b}, x]</pre>
</div>
<p>gives a fit for the coefficients. From this, we can get the functional form by
using</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Normal</span><span class="p">[</span><span class="n">fit</span><span class="p">]</span>
</pre></div>
</div>
<p>which gives</p>
<div class="highlight-python"><pre>2.00009 x^2.99998</pre>
</div>
<p>But we can go far beyond that. For example, we can look at the parameter table:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fit</span><span class="p">[</span><span class="s">&quot;ParameterTable&quot;</span><span class="p">]</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="5%" />
<col width="17%" />
<col width="28%" />
<col width="22%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&nbsp;</th>
<th class="head">Estimate</th>
<th class="head">Standard Error</th>
<th class="head">t-Statistic</th>
<th class="head">P-Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>a</td>
<td>2.00009</td>
<td>0.0000894033</td>
<td>22371.5</td>
<td>1.78507*10^-32</td>
</tr>
<tr class="row-odd"><td>b</td>
<td>2.99998</td>
<td>0.000020244</td>
<td>148191</td>
<td>4.81551*10^-39</td>
</tr>
</tbody>
</table>
<p>What does this mean? The estimate is the best-guess (by least-squares or other
method), and the standard error is calculated by using this estimate as the mean
in the data using a similar calculation to the standard deviation. The t-Statistic
is how many standard errors away from 0 the estimate is (same concept as the
z-score, but for the t distribution which is slightly different, but similar
enough for our purposes). The p-value is then the p-value associated with this
distribution with a mean of zero as the null hypothesis.</p>
<p>There are many other properties of the model we can extract &#8211; from the
confidence intervals (&#8220;ParameterConfidenceIntervals&#8221;) to the residuals
(difference between actual and predicted responses &#8211; &#8220;FitResiduals&#8221;)
to <span class="math">\(R^2\)</span> (the &#8220;coefficient of determination&#8221; that says what
percent of variance in the data is explained by the fitted model &#8211; &#8220;RSquared&#8221;).
For more, see the documentation for <tt class="code docutils literal"><span class="pre">NonlinearModelFit</span></tt>.</p>
</div>
</div>


</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
    </p>
    <p>
    <!--
        &copy; Copyright 2013, University of Texas at Austin Society of Physics Students and Sigma Pi Sigma.-->
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </p>
  </div>
</footer>

<script type="text/javascript" charset="utf-8">
    //$(document).ready(addUserToFooter);
    $(document).ready(addNavbarLoginLink);
    $(document).ready(createEditors);
    //$(document).ready(getNumUsers);
    //$(document).ready(getOnlineUsers);
    $(document).ready(createScratchActivecode());
    $(document).ready(styleUnittestResults());
</script>

<script type="text/javascript">
  $("#mainbody").children().first().css("margin-top",
    $("#navbar").css("height"))
</script>

<script type="text/javascript">
  // add the video play button overlay image
  $(".video-play-overlay").each(function() {
    $(this).css('background-image', "url(\'../_static/play_overlay_icon.png\')")
    });

  // This function is needed to allow the dropdown search bar to work;
  // The default behaviour is that the dropdown menu closes when something in
  // it (like the search bar) is clicked
  $(function() {
    // Fix input element click problem
    $('.dropdown input, .dropdown label').click(function(e) {
      e.stopPropagation();
      });
  });

  // style codelens buttons (doing it here because PyTutor is a submodule owned by someone else
  $(function() {
    $(".ExecutionVisualizer").each(function() {
      $(this).find("#jmpFirstInstr").addClass('btn btn-small btn-default');
      $(this).find("#jmpStepBack").addClass('btn btn-small btn-danger');
      $(this).find("#jmpStepFwd").addClass('btn btn-small btn-success');
      $(this).find("#jmpLastInstr").addClass('btn btn-small btn-default');
      });
  });

</script>


<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32029811-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>