
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Curve Fitting &mdash; Introduction to Data Analysis for Physics</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.0.0-rc1/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/video.css" type="text/css" />
    <link rel="stylesheet" href="../_static/poll.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tabbedstuff.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/pytutor.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/codemirror.css" type="text/css" />
    <link rel="stylesheet" href="../_static/activecode.css" type="text/css" />
    <link rel="stylesheet" href="../_static/parsons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/lib/prettify.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.0.0-rc1/css/bootstrap-glyphicons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/jquery-ui-1.10.3.custom.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/user-highlights.css" type="text/css" />
    <link rel="stylesheet" href="../../runestone-custom-sphinx-bootstrap.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/poll.js"></script>
    <script type="text/javascript" src="../_static/js/d3.v2.min.js"></script>
    <script type="text/javascript" src="../_static/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery.ba-bbq.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery.jsPlumb-1.3.10-all-min.js"></script>
    <script type="text/javascript" src="../_static/js/pytutor.js"></script>
    <script type="text/javascript" src="../_static/jquery.highlight.js"></script>
    <script type="text/javascript" src="../_static/bookfuncs.js"></script>
    <script type="text/javascript" src="../_static/codemirror.js"></script>
    <script type="text/javascript" src="../_static/python.js"></script>
    <script type="text/javascript" src="../_static/activecode.js"></script>
    <script type="text/javascript" src="../_static/skulpt.js"></script>
    <script type="text/javascript" src="../_static/builtin.js"></script>
    <script type="text/javascript" src="../_static/assess.js"></script>
    <script type="text/javascript" src="../_static/animationbase.js"></script>
    <script type="text/javascript" src="../_static/lib/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/lib/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../_static/lib/prettify.js"></script>
    <script type="text/javascript" src="../_static/lib/underscore-min.js"></script>
    <script type="text/javascript" src="../_static/lib/lis.js"></script>
    <script type="text/javascript" src="../_static/parsons.js"></script>
    <script type="text/javascript" src="../_static/parsons-noconflict.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/jquery-ui-1.10.3.custom.min.js"></script>
    <script type="text/javascript" src="../_static/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.0.0-rc1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <script type="text/javascript" src="../_static/waypoints.min.js"></script>
    <script type="text/javascript" src="../_static/rangy-core.js"></script>
    <script type="text/javascript" src="../_static/rangy-textrange.js"></script>
    <script type="text/javascript" src="../_static/rangy-cssclassapplier.js"></script>
    <script type="text/javascript" src="../_static/user-highlights.js"></script>
    <script type="text/javascript" src="../_static/jquery.idle-timer.js"></script>
    <script type="text/javascript" src="../_static/processing-1.4.1.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.hotkey.js"></script>
    <link rel="top" title="Introduction to Data Analysis for Physics" href="../index.html" />
    <link rel="next" title="Introduction" href="../LaTeX/latex.html" />
    <link rel="prev" title="Animations" href="animations.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
<script type="text/javascript">
  eBookConfig = {};
  eBookConfig.host = 'http://127.0.0.1:8000' ? 'http://127.0.0.1:8000' : 'http://127.0.0.1:8000';
  eBookConfig.app = eBookConfig.host+'/runestone';
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.course = 'data_analysis';
  eBookConfig.logLevel = 10;
  eBookConfig.loginRequired = false
  eBookConfig.isLoggedIn = false;
</script>

<div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&status=0";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>


  </head>
  <body>


<!-- Begin navbar -->
<div id="navbar" class="navbar navbar-fixed-top" style="z-index:9999999">

  <div class="container">

    <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
    <button type='button' class='navbar-toggle' data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>

    <div>
      <a href="../index.html">
      <img title="Data Analysis for Physics" src="../_static/img/logo_small.png"
       style="max-width:60px; max-height:60px;float:left"></a>
      <a class="navbar-brand" href="../index.html">Introduction to Data Analysis for Physics</a>
    </div>

    <div class="nav-collapse collapse navbar-responsive-collapse">

      <ul class="nav navbar-nav">
        <li class="divider-vertical"></li>
        
          <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Curve Fitting</a><ul>
<li><a class="reference internal" href="#residuals">Residuals</a></li>
<li><a class="reference internal" href="#least-squares-fitting">Least-Squares Fitting</a></li>
</ul>
</li>
</ul>
</ul>
</li>
          <li class="divider-vertical"></li>
        
        
          
  <li id="relations-prev" title="Previous Chapter - Animations" data-toggle="tooltip">
    <a href="animations.html" >
      <i class='glyphicon glyphicon-backward' style='opacity:0.9;'></i>
      <p style=";max-width:130px;">Animations</p>
    </a>
  </li>
  
  <li id="relations-next" title='Next Chapter - Introduction' data-toggle="tooltip" >
    <a href="../LaTeX/latex.html" >
      <i class='glyphicon glyphicon-forward' style='opacity:0.9;'></i>
      <p style=";max-width:130px;">Introduction</p>
    </a>
  </li>
  <li style="divider-vertical"></li>

<script type="text/javascript">
  opts = {'placement':'bottom',
          'selector': '',
          'delay': { show: 100, hide: 50}
         };

  $('#relations-prev').tooltip(opts);
  $('#relations-next').tooltip(opts);
</script>
        
        
          <li></li>
        
      </ul>

    </div>
  </div>
</div>


<div id="mainbody" class="container">
  
  <div class="section" id="curve-fitting">
<h1>Curve Fitting<a class="headerlink" href="#curve-fitting" title="Permalink to this headline">Â¶</a></h1>
<p>To best learn about the curve fitting process, we&#8217;ll go through a contrived example to
show some of the relevant <em>Mathematica</em> features, then describe how the functions
work and how to apply them in a lab scenario, introducing other useful mathematical
constructs along the way to help you analyze your data.
s
Example
&#8212;&#8212;-
One part of analyzing data that is frequently useful is where we have some set of
data and a model to which we believe it corresponds. Then, we can have <em>Mathematica</em>
find a fit for the data based on the model. For an example of how this works,
let&#8217;s sample points from <span class="math">\((x-2)^2-1=x^2-4x+3\)</span>, then have <em>Mathematica</em> fit
this (incorrectly) to <span class="math">\(ax^2+bx\)</span>:</p>
<div class="highlight-python"><pre>t = Table[{x, (x - 2)^2 - 1}, {x, -10, 10}];
fn[x_] := a x^2 + b x
fit = FindFit[t, fn[x], {a, b}, {x}];
fn[x] /. fit
Show[ListPlot[t], Plot[fn[x] /. fit, {x, -10, 10}], PlotRange -&gt; All]</pre>
</div>
<p>prints</p>
<div class="highlight-python"><pre>-4. x + 1.04559 x^2</pre>
</div>
<p>and plots</p>
<div class="figure align-center">
<img alt="Fitted curve" src="Mathematica\Figures/fit_curve.png" />
<p class="caption">Plot of data from <span class="math">\(f(x)=(x-2)^2-1\)</span> plotted against fitted curve for
<span class="math">\(g(x)=ax^2+bx\)</span>.</p>
</div>
<div class="section" id="residuals">
<h2>Residuals<a class="headerlink" href="#residuals" title="Permalink to this headline">Â¶</a></h2>
<p>It is not immediately clear that this fit is bad (although if we calculated the <span class="math">\(R^2\)</span>
statistical value, we would have a better indication than just the graph). So, one important
thing to always do is to view the residuals of the fit. If we have a point in the dataset
<span class="math">\((x_i, f_i)\)</span>, and fitted function <span class="math">\(\hat{f}\)</span>, the fitted value at <span class="math">\(x_i\)</span>
is simply <span class="math">\(\hat{f}(x_i)\)</span>. Then, the residual is the difference between data and
fitted values <span class="math">\(f_i-\hat{f}(x_i)\)</span>. If we plot this versus our independent variable</p>
<div class="highlight-python"><pre>r = Table[{t[[i, 1]], t[[i, 2]] - fn[t[[i, 1]]] /. fit},
{i, 1, Length[t]}];
ListPlot[r]</pre>
</div>
<p>we can see if any kind of pattern arises (again, a visual inspection, but a useful one
nevertheless - we&#8217;ll add statistics momentarily):</p>
<div class="figure align-center">
<img alt="Bad residual plot" src="Mathematica\Figures/bad_resid.png" />
<p class="caption">Residual plot for data and fitted curve.</p>
</div>
<p>Here, we see that there is indeed a clear pattern to the residual plot (a parabola). Recall
that we didn&#8217;t fit the correct function, so we might expect the residuals to follow some
sort of predictable distribution that accounts for the difference between actual function
and the one fitted.</p>
</div>
<div class="section" id="least-squares-fitting">
<h2>Least-Squares Fitting<a class="headerlink" href="#least-squares-fitting" title="Permalink to this headline">Â¶</a></h2>
<p><em>Mathematica</em> performs what is known as a least-squares fit of the data when applying
the <tt class="code docutils literal"><span class="pre">FindFit</span></tt> function. In short, using the notation above, a least-squares fit
is one that creates a function such that the following quantity is minimized:</p>
<div class="math">
\[\sum_{i=1}^Nr_i^2=\sum_{i=1}^N\left(f_i-\hat{f}(x_i)\right)^2\]</div>
<p>But minimizing a quantity means finding a critical point, which we can do by noting that
the derivative of the quantity above is 0 with respect to all coefficients that are being
fitted. So, if the function to be fitted is a function of <span class="math">\(M\)</span> coeffiencents
<span class="math">\(\{c_j\}\)</span>, we have that:</p>
<div class="math">
\[\begin{split}\forall{j\in[1,M]}:&amp;\\
0&amp;=\sum_{i=1}^N2r_i\frac{dr_i}{dc_j}\\
&amp;=\sum_{i=1}^N2r_i\frac{d\left(f_i-\hat{f}(x_i)\right)}{dc_j}\\
&amp;=-2\sum_{i=1}^N\left(f_i-\hat{f}(x_i)\right)\frac{d\hat{f}(x_i)}{dc_j}\end{split}\]</div>
<p>We know the function we are trying to fit, and have the data. Thus, we have
everything we need to be able to solve this, presuming that we can then solve
the resulting equations for all the coefficients.</p>
<div class="note admonition">
<p class="first admonition-title">Least-Squares Example</p>
<p>For an example, let&#8217;s take the data <tt class="xref download docutils literal"><span class="pre">here</span></tt>.
Go ahead and import it using the techniques described in the
<a class="reference external" href="../Mathematica/import.html">Import</a> section, then plot the data.
You should see 6 points that look linear. Let&#8217;s assume the function
is <span class="math">\(ax+b\)</span>. Let&#8217;s see what our equation above tells us.</p>
<p><span class="math">\(\frac{d\hat{f}(x)}{da}=x,~\frac{d\hat{f}(x)}{db}=1\)</span>. So,</p>
<div class="last math">
\[\begin{split}0&amp;=\left(3.11431-(0a+b)\right)*0+\left(8.14437-(a+b)\right)*1 +
                \left(13.2145-(2a+b)\right)*2\\
&amp;+\left(18.2655-(3a+b)\right)*3+\left(23.2041-(4a+b)\right)*4 +
                +\left(28.3593-(5a+b)\right)*5
{\textrm{and}}&amp;
0&amp;=\left(3.11431-(0a+b)\right)+\left(8.14437-(a+b)\right) +
                \left(13.2145-(2a+b)\right)\\
&amp;+\left(18.2655-(3a+b)\right)+\left(23.2041-(4a+b)\right) +
                +\left(28.3593-(5a+b)\right)\end{split}\]</div>
</div>
</div>
</div>


</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
    </p>
    <p>
    <!--
        &copy; Copyright 2013, University of Texas at Austin Society of Physics Students and Sigma Pi Sigma.-->
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </p>
  </div>
</footer>

<script type="text/javascript" charset="utf-8">
    //$(document).ready(addUserToFooter);
    $(document).ready(addNavbarLoginLink);
    $(document).ready(createEditors);
    //$(document).ready(getNumUsers);
    //$(document).ready(getOnlineUsers);
    $(document).ready(createScratchActivecode());
    $(document).ready(styleUnittestResults());
</script>

<script type="text/javascript">
  $("#mainbody").children().first().css("margin-top",
    $("#navbar").css("height"))
</script>

<script type="text/javascript">
  // add the video play button overlay image
  $(".video-play-overlay").each(function() {
    $(this).css('background-image', "url(\'../_static/play_overlay_icon.png\')")
    });

  // This function is needed to allow the dropdown search bar to work;
  // The default behaviour is that the dropdown menu closes when something in
  // it (like the search bar) is clicked
  $(function() {
    // Fix input element click problem
    $('.dropdown input, .dropdown label').click(function(e) {
      e.stopPropagation();
      });
  });

  // style codelens buttons (doing it here because PyTutor is a submodule owned by someone else
  $(function() {
    $(".ExecutionVisualizer").each(function() {
      $(this).find("#jmpFirstInstr").addClass('btn btn-small btn-default');
      $(this).find("#jmpStepBack").addClass('btn btn-small btn-danger');
      $(this).find("#jmpStepFwd").addClass('btn btn-small btn-success');
      $(this).find("#jmpLastInstr").addClass('btn btn-small btn-default');
      });
  });

</script>


<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32029811-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>