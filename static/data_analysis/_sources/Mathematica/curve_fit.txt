Curve Fitting
=============
To best learn about the curve fitting process, we'll go through a contrived example to
show some of the relevant *Mathematica* features, then describe how the functions
work and how to apply them in a lab scenario, introducing other useful mathematical
constructs along the way to help you analyze your data.
s
Example
-------
One part of analyzing data that is frequently useful is where we have some set of
data and a model to which we believe it corresponds. Then, we can have *Mathematica*
find a fit for the data based on the model. For an example of how this works,
let's sample points from :math:`(x-2)^2-1=x^2-4x+3`, then have *Mathematica* fit
this (incorrectly) to :math:`ax^2+bx`:

::

	t = Table[{x, (x - 2)^2 - 1}, {x, -10, 10}];
	fn[x_] := a x^2 + b x
	fit = FindFit[t, fn[x], {a, b}, {x}];
	fn[x] /. fit
	Show[ListPlot[t], Plot[fn[x] /. fit, {x, -10, 10}], PlotRange -> All]

prints

::

	-4. x + 1.04559 x^2

and plots

.. figure:: Figures/fit_curve.png
	:alt: Fitted curve
	:align: center

	Plot of data from :math:`f(x)=(x-2)^2-1` plotted against fitted curve for 
	:math:`g(x)=ax^2+bx`.

Residuals
---------
It is not immediately clear that this fit is bad (although if we calculated the :math:`R^2`
statistical value, we would have a better indication than just the graph). So, one important
thing to always do is to view the residuals of the fit. If we have a point in the dataset
:math:`(x_i, f_i)`, and fitted function :math:`\hat{f}`, the fitted value at :math:`x_i`
is simply :math:`\hat{f}(x_i)`. Then, the residual is the difference between data and
fitted values :math:`f_i-\hat{f}(x_i)`. If we plot this versus our independent variable

::

	r = Table[{t[[i, 1]], t[[i, 2]] - fn[t[[i, 1]]] /. fit},
	{i, 1, Length[t]}];
	ListPlot[r]

we can see if any kind of pattern arises (again, a visual inspection, but a useful one 
nevertheless - we'll add statistics momentarily):

.. figure:: Figures/bad_resid.png
	:alt: Bad residual plot
	:align: center

	Residual plot for data and fitted curve.

Here, we see that there is indeed a clear pattern to the residual plot (a parabola). Recall
that we didn't fit the correct function, so we might expect the residuals to follow some
sort of predictable distribution that accounts for the difference between actual function
and the one fitted.

Least-Squares Fitting
----------------------
*Mathematica* performs what is known as a least-squares fit of the data when applying
the :code:`FindFit` function. In short, using the notation above, a least-squares fit
is one that creates a function such that the following quantity is minimized:

.. math::

	\sum_{i=1}^Nr_i^2=\sum_{i=1}^N\left(f_i-\hat{f}(x_i)\right)^2

But minimizing a quantity means finding a critical point, which we can do by noting that
the derivative of the quantity above is 0 with respect to all coefficients that are being
fitted. So, if the function to be fitted is a function of :math:`M` coeffiencents
:math:`\{c_j\}`, we have that:

.. math::

	\forall{j\in[1,M]}:&\\
	0&=\sum_{i=1}^N2r_i\frac{dr_i}{dc_j}\\
	&=\sum_{i=1}^N2r_i\frac{d\left(f_i-\hat{f}(x_i)\right)}{dc_j}\\
	&=-2\sum_{i=1}^N\left(f_i-\hat{f}(x_i)\right)\frac{d\hat{f}(x_i)}{dc_j}

We know the function we are trying to fit, and have the data. Thus, we have
everything we need to be able to solve this, presuming that we can then solve
the resulting equations for all the coefficients.

.. admonition:: Least-Squares Example
	:class: note

	For an example, let's take the data :download:`here <data/least_squares.csv>`.
	Go ahead and import it using the techniques described in the
	`Import <../Mathematica/import.html>`_ section, then plot the data.
	You should see 6 points that look linear. Let's assume the function
	is :math:`ax+b`. Let's see what our equation above tells us.

	:math:`\frac{d\hat{f}(x)}{da}=x,~\frac{d\hat{f}(x)}{db}=1`. So,

	.. math::

		0&=\left(3.11431-(0a+b)\right)*0+\left(8.14437-(a+b)\right)*1 +
				\left(13.2145-(2a+b)\right)*2\\
		&+\left(18.2655-(3a+b)\right)*3+\left(23.2041-(4a+b)\right)*4 +
				+\left(28.3593-(5a+b)\right)*5
		{\textrm{and}}&
		0&=\left(3.11431-(0a+b)\right)+\left(8.14437-(a+b)\right) +
				\left(13.2145-(2a+b)\right)\\
		&+\left(18.2655-(3a+b)\right)+\left(23.2041-(4a+b)\right) +
				+\left(28.3593-(5a+b)\right)